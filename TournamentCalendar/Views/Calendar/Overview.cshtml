@model TournamentCalendar.Models.Calendar.BrowseModel
@using TournamentCalendar.Controllers
@using TournamentCalendar.Views
<div class="row">
    <article class="col-md-6">
        <h3 class="h3">Turnierkalender</h3>
        <p>
            Auf dieser Seite erscheinen primär Volleyball-Turniere aus dem deutschsprachigen Raum.
        </p>
        <p>
            Wer möchte, wird mit <b>@Html.ActionLink("Volley-News", nameof(InfoService.Index), nameof(InfoService), null, new { @class = "link" })</b> per E-Mail über neue Einträge im Turnierkalender informiert.
        </p>
        <p>
            Findet ein Turnier statt, das hier nicht aufgeführt ist?
            <b>@Html.ActionLink("Gleich in den Kalender eintragen.", nameof(Calendar.Entry), nameof(Calendar), null, new { @class = "link" })</b>
        </p>
    </article>
    <article class="col-md-6 d-none d-md-block">
        @* Hide on devices smaller than MD *@
    <img src="@Url.Content("~/images/ball-crown.jpg")" class="rounded text-right" alt="Turniere" style="width: 100%" />
</article>
<article class="col-md-12">
    @if (Model.DisplayModel.Any())
    {
        var rec = Model.DisplayModel.Last();
        <input id="searchInput" placeholder="Begriff(e) zum Filtern der Tabelle" class="form-control" style="max-width: 350px; margin-top: 10px" />
            <label for="searchInput" style="margin: 0 0 10px 0; font-size: 1rem">(z.B.: &quot;<b>.@rec.DateFrom.ToString("MM"). @string.Join(string.Empty, rec.GetTournamentType().Take(3)).ToLower()</b>&quot; für &quot;alle @rec.GetTournamentType()-Turniere im @rec.DateFrom.ToString("MMMM")&quot; oder &quot;<b>de-10</b>&quot; für Turniere im PLZ-Bereich 10...)</label>
            <noscript><div>Dafür muss Javascript im Browser aktiviert sein.</div></noscript>
    }
</article>
<article class="col-md-12 table-responsive">
    <table id="tournaments-table" class="table table-striped table-bordered table-hover nowrap rounded">
        <thead>
            <tr>
                <th>Datum</th>
                <th>Turniername</th>
                @*<th>Ausrichter</th>*@
                <th>Art</th>
                <th>Belag</th>
                <th>PLZ</th>
                <th class="text-right"><i class="fa fa-info-circle"></i></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var m in Model.DisplayModel)
            {
                <tr title="Details zu &quot;@m.TournamentName&quot; - @m.Organizer" style="cursor: pointer" onclick="document.location = '@Url.Action(nameof(Calendar.Id), nameof(Calendar), new {id = m.Id})';return false;">
                    <td>@m.DateFrom.ToString("dd.MM.yy")</td>
                    <td>@m.GetTournamentNameShort(60)</td>
                    @*<td>@m.GetOrganizerShort(20)</td>*@
                    <td>@m.GetTournamentTypeShort()</td>
                    <td>@m.GetSurface()</td>
                    <td>@m.CountryId-@m.PostalCode</td>
                    <td class="text-right"><a href="@Url.Action(nameof(Calendar.Id), nameof(Calendar), new {id = m.Id})" style="text-decoration: none"><i class="fa fa-info-circle @((DateTime.Now.Date - m.ModifiedOn.Date).Days < 2 ? "text-primary" : "")"></i></a></td>
                </tr>
            }
        </tbody>
    </table>
</article>

<article class="col-12 pb-2">
    <h5 class="h5">Weitere Volleyball-Turniere sind hier zu finden</h5>
    <a href="http://www.volleyball-verband.de" class="link">www.volleyball-verband.de</a><br />
    <a href="http://www.vobatu.de" class="link">www.vobatu.de</a><br />
    <a href="http://www.volleyballer.de" class="link">www.volleyballer.de</a><br />
</article>
</div>
@section MetaSection {<meta name="robots" content="index, follow">}
@section CssSection {<link href="@Url.Content(CssName.Lib.DatatablesCss)" rel="stylesheet" />}
@section ScriptStandardSection {
    <script src="@Url.Content(ScriptName.Lib.MomentJs)"></script>
    <script src="@Url.Content(ScriptName.Lib.DatatablesJs)"></script>
    <script type="text/javascript">
//<![CDATA[
$(document).ready(function() {
    $.fn.dataTable.moment('DD.MM.YY');
        var table = $('#tournaments-table').DataTable({
        "dom": 'lrtip',
        "language": {
            "url": "@Url.Content(ScriptName.Lib.DatatablesGermanJson)"
        },
        "responsive": false,
        "paging": false,
        "ordering": true,
        "info": true,
        "infoCallback": function(settings, start, end, max, total, pre) {
            var api = this.api();
            var pageInfo = api.page.info();
            if (max === total)
                return total + (total === 1 ? ' Eintrag' : ' Einträge');
            else {
                return total + (total === 1 ? ' Eintrag' : ' Einträge') + ' gefiltert von insgesamt ' + max;
            }
        },
        "columnDefs": [
            { "orderable": false, "targets": 5 }
        ],
        "order": [[0, 'asc']]
    });

    $('#searchInput').on('keyup',
        function() {
            table.search(this.value).draw();
        }).focus();
});
//]]>
    </script>
}
